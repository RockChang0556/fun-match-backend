# 1Panel éƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹ä½¿ç”¨ 1Panel ç®¡ç†é¢æ¿çš„æœåŠ¡å™¨ç¯å¢ƒï¼Œæä¾›äº†ä¼˜åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆå’Œç®¡ç†å·¥å…·ã€‚

## 1Panel ä¼˜åŠ¿

- ğŸ›ï¸ **å¯è§†åŒ–ç•Œé¢**: é€šè¿‡ Web ç•Œé¢ç®¡ç†å®¹å™¨å’Œé•œåƒ
- ğŸ“Š **èµ„æºç›‘æ§**: å®æ—¶ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
- ğŸ”§ **ä¾¿æ·æ“ä½œ**: ä¸€é”®å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨
- ğŸ“ **æ—¥å¿—æŸ¥çœ‹**: å›¾å½¢åŒ–æ—¥å¿—æŸ¥çœ‹å’Œç®¡ç†
- ğŸŒ **ç½‘ç»œç®¡ç†**: å¯è§†åŒ–ç½‘ç»œé…ç½®å’Œç®¡ç†

## ç¯å¢ƒå‡†å¤‡

### 1. 1Panel å®‰è£…

ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… 1Panelï¼Œå¦‚æœæœªå®‰è£…ï¼Œè¯·å‚è€ƒ [1Panel å®˜æ–¹æ–‡æ¡£](https://1panel.cn/docs/) è¿›è¡Œå®‰è£…ã€‚

### 2. Docker é…ç½®

åœ¨ 1Panel ä¸­ç¡®ä¿ Docker æœåŠ¡æ­£å¸¸è¿è¡Œï¼š

- è¿›å…¥ 1Panel æ§åˆ¶å°
- æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€
- ç¡®ä¿ Docker ç½‘ç»œé…ç½®æ­£ç¡®

### 3. GitHub Secrets é…ç½®

åœ¨ GitHub ä»“åº“çš„ `Settings > Secrets and variables > Actions` ä¸­é…ç½®ï¼š

```
HUB_GITHUB_TOKEN     # GitHub Personal Access Token
SERVER_HOST          # æœåŠ¡å™¨ IP åœ°å€
SERVER_USERNAME      # æœåŠ¡å™¨ç”¨æˆ·å
SERVER_PWD           # æœåŠ¡å™¨å¯†ç 
SERVER_PORT          # SSH ç«¯å£ (é»˜è®¤ 22)
```

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. æ¨é€åˆ°ä¸»åˆ†æ”¯

```bash
git push origin main
```

GitHub Actions å°†è‡ªåŠ¨ï¼š

- æ„å»º Docker é•œåƒ
- æ¨é€åˆ° GitHub Container Registry
- éƒ¨ç½²åˆ° 1Panel æœåŠ¡å™¨

#### 2. åœ¨ 1Panel ä¸­æŸ¥çœ‹

- ç™»å½• 1Panel æ§åˆ¶å°
- è¿›å…¥ "å®¹å™¨" é¡µé¢
- æŸ¥çœ‹ `nestjs-backend` å®¹å™¨çŠ¶æ€

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp deploy-1panel.sh docker-compose-1panel.yml nginx.conf user@server:/home/user/nestjs-backend/
```

#### 2. æ‰§è¡Œéƒ¨ç½²

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh user@server

# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /home/user/nestjs-backend/

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x deploy-1panel.sh

# ç™»å½•å®¹å™¨æ³¨å†Œè¡¨
docker login ghcr.io -u your-username

# æ‰§è¡Œéƒ¨ç½²
./deploy-1panel.sh production latest
```

## 1Panel ç®¡ç†æ“ä½œ

### 1. å®¹å™¨ç®¡ç†

#### åœ¨ 1Panel ç•Œé¢ä¸­ï¼š

- **å¯åŠ¨å®¹å™¨**: ç‚¹å‡»å®¹å™¨åç§° â†’ å¯åŠ¨
- **åœæ­¢å®¹å™¨**: ç‚¹å‡»å®¹å™¨åç§° â†’ åœæ­¢
- **é‡å¯å®¹å™¨**: ç‚¹å‡»å®¹å™¨åç§° â†’ é‡å¯
- **åˆ é™¤å®¹å™¨**: ç‚¹å‡»å®¹å™¨åç§° â†’ åˆ é™¤

#### ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
# å¿«é€Ÿæ“ä½œ
./quick-actions.sh start    # å¯åŠ¨
./quick-actions.sh stop     # åœæ­¢
./quick-actions.sh restart  # é‡å¯
./quick-actions.sh logs     # æŸ¥çœ‹æ—¥å¿—
./quick-actions.sh status   # æŸ¥çœ‹çŠ¶æ€
./quick-actions.sh shell    # è¿›å…¥å®¹å™¨
./quick-actions.sh update   # æ›´æ–°
```

### 2. èµ„æºç›‘æ§

#### åœ¨ 1Panel ä¸­ç›‘æ§ï¼š

- è¿›å…¥ "å®¹å™¨" é¡µé¢
- æŸ¥çœ‹ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
- ç›‘æ§ç½‘ç»œ I/O å’Œç£ç›˜ I/O

#### ä½¿ç”¨ç›‘æ§è„šæœ¬ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
./monitor.sh
```

### 3. æ—¥å¿—ç®¡ç†

#### åœ¨ 1Panel ä¸­æŸ¥çœ‹ï¼š

- è¿›å…¥ "å®¹å™¨" é¡µé¢
- ç‚¹å‡»å®¹å™¨åç§°
- é€‰æ‹© "æ—¥å¿—" æ ‡ç­¾é¡µ

#### ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f nestjs-backend

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
docker logs --tail 100 nestjs-backend

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ—¥å¿—
docker logs --since "2024-01-01T00:00:00" nestjs-backend
```

## é…ç½®è¯´æ˜

### 1. å®¹å™¨é…ç½®

#### èµ„æºé™åˆ¶

```yaml
deploy:
  resources:
    limits:
      memory: 512M # æœ€å¤§å†…å­˜
      cpus: '0.5' # æœ€å¤§ CPU
    reservations:
      memory: 256M # é¢„ç•™å†…å­˜
      cpus: '0.25' # é¢„ç•™ CPU
```

#### å¥åº·æ£€æŸ¥

```yaml
healthcheck:
  test:
    [
      'CMD',
      'node',
      '-e',
      "require('http').get('http://localhost:3000/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })",
    ]
  interval: 30s # æ£€æŸ¥é—´éš”
  timeout: 10s # è¶…æ—¶æ—¶é—´
  retries: 3 # é‡è¯•æ¬¡æ•°
  start_period: 40s # å¯åŠ¨ç­‰å¾…æ—¶é—´
```

### 2. ç½‘ç»œé…ç½®

#### 1Panel ç½‘ç»œ

```yaml
networks:
  1panel-network:
    driver: bridge
    labels:
      - '1panel.network.name=1panel-network'
```

#### ç«¯å£æ˜ å°„

```yaml
ports:
  - '11000:3000' # ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
```

### 3. å­˜å‚¨é…ç½®

#### æ•°æ®å·

```yaml
volumes:
  - ./logs:/app/logs # æ—¥å¿—ç›®å½•
  - ./config:/app/config:ro # é…ç½®æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
  - ./data:/app/data # æ•°æ®ç›®å½•
```

## æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

#### å®¹å™¨å¯åŠ¨å¤±è´¥

**é—®é¢˜**: å®¹å™¨æ— æ³•å¯åŠ¨
**è§£å†³**:

1. åœ¨ 1Panel ä¸­æŸ¥çœ‹å®¹å™¨æ—¥å¿—
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
3. éªŒè¯é•œåƒæ˜¯å¦æ­£ç¡®æ‹‰å–
4. æ£€æŸ¥èµ„æºé™åˆ¶æ˜¯å¦åˆç†

#### å¥åº·æ£€æŸ¥å¤±è´¥

**é—®é¢˜**: å¥åº·æ£€æŸ¥ä¸é€šè¿‡
**è§£å†³**:

1. æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. éªŒè¯å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health`
3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### èµ„æºä¸è¶³

**é—®é¢˜**: å®¹å™¨å› èµ„æºä¸è¶³è¢«æ€æ­»
**è§£å†³**:

1. åœ¨ 1Panel ä¸­è°ƒæ•´èµ„æºé™åˆ¶
2. æ£€æŸ¥æœåŠ¡å™¨å¯ç”¨èµ„æº
3. ä¼˜åŒ–åº”ç”¨é…ç½®

### 2. æ—¥å¿—åˆ†æ

#### åº”ç”¨æ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/2024-01-01_info.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/2024-01-01_error.log
```

#### å®¹å™¨æ—¥å¿—

```bash
# æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿—
docker logs nestjs-backend

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs -f nestjs-backend
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### èµ„æºè°ƒä¼˜

1. **å†…å­˜ä¼˜åŒ–**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´å†…å­˜é™åˆ¶
2. **CPU ä¼˜åŒ–**: åˆç†åˆ†é… CPU èµ„æº
3. **ç½‘ç»œä¼˜åŒ–**: ä½¿ç”¨ 1Panel ç½‘ç»œç®¡ç†åŠŸèƒ½

#### åº”ç”¨ä¼˜åŒ–

1. **æ—¥å¿—è½®è½¬**: é…ç½®æ—¥å¿—è‡ªåŠ¨è½®è½¬
2. **ç¼“å­˜ç­–ç•¥**: å¯ç”¨åº”ç”¨ç¼“å­˜
3. **æ•°æ®åº“è¿æ¥**: ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± 

## ç›‘æ§å’Œç»´æŠ¤

### 1. 1Panel ç›‘æ§

#### å®¹å™¨ç›‘æ§

- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç½‘ç»œ I/O
- ç£ç›˜ I/O

#### ç³»ç»Ÿç›‘æ§

- æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ
- ç£ç›˜ç©ºé—´
- ç½‘ç»œçŠ¶æ€

### 2. å‘Šè­¦é…ç½®

#### åœ¨ 1Panel ä¸­è®¾ç½®ï¼š

1. è¿›å…¥ "ç›‘æ§" é¡µé¢
2. é…ç½®èµ„æºä½¿ç”¨å‘Šè­¦
3. è®¾ç½®å®¹å™¨çŠ¶æ€å‘Šè­¦

#### è‡ªå®šä¹‰ç›‘æ§ï¼š

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /etc/cron.d/nestjs-monitor << EOF
# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡å®¹å™¨çŠ¶æ€
*/5 * * * * root /home/user/nestjs-backend/monitor.sh >> /var/log/nestjs-monitor.log 2>&1
EOF
```

### 3. å¤‡ä»½ç­–ç•¥

#### å®¹å™¨å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½å®¹å™¨
docker commit nestjs-backend nestjs-backup-$(date +%Y%m%d)

# å¯¼å‡ºå®¹å™¨
docker export nestjs-backend > nestjs-backup.tar
```

#### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®ç›®å½•
tar -czf data-backup-$(date +%Y%m%d).tar.gz ./data

# å¤‡ä»½é…ç½®
tar -czf config-backup-$(date +%Y%m%d).tar.gz ./config
```

## é«˜çº§åŠŸèƒ½

### 1. å¤šç¯å¢ƒéƒ¨ç½²

#### å¼€å‘ç¯å¢ƒ

```bash
./deploy-1panel.sh development dev-latest
```

#### ç”Ÿäº§ç¯å¢ƒ

```bash
./deploy-1panel.sh production latest
```

### 2. æ»šåŠ¨æ›´æ–°

#### é›¶åœæœºæ›´æ–°

```bash
# ä½¿ç”¨ Docker Compose è¿›è¡Œæ»šåŠ¨æ›´æ–°
docker-compose -f docker-compose-1panel.yml up -d --no-deps nestjs-backend
```

### 3. è´Ÿè½½å‡è¡¡

#### å¤šå®ä¾‹éƒ¨ç½²

```yaml
# åœ¨ docker-compose-1panel.yml ä¸­é…ç½®å¤šä¸ªå®ä¾‹
services:
  nestjs-backend-1:
    # ... é…ç½®
  nestjs-backend-2:
    # ... é…ç½®
  nginx:
    # é…ç½®è´Ÿè½½å‡è¡¡
```

## æœ€ä½³å®è·µ

### 1. å®‰å…¨å»ºè®®

- å®šæœŸæ›´æ–°é•œåƒ
- ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨
- é…ç½®é˜²ç«å¢™è§„åˆ™
- å®šæœŸå¤‡ä»½æ•°æ®

### 2. æ€§èƒ½å»ºè®®

- åˆç†è®¾ç½®èµ„æºé™åˆ¶
- ä½¿ç”¨ SSD å­˜å‚¨
- é…ç½®æ—¥å¿—è½®è½¬
- å¯ç”¨åº”ç”¨ç¼“å­˜

### 3. ç»´æŠ¤å»ºè®®

- å®šæœŸæ£€æŸ¥å®¹å™¨çŠ¶æ€
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ
- åŠæ—¶æ›´æ–°ä¾èµ–
- ä¿æŒæ–‡æ¡£æ›´æ–°

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ 1Panel å®¹å™¨æ—¥å¿—
2. æ£€æŸ¥ GitHub Actions æ—¥å¿—
3. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
4. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

---

**æ³¨æ„**: æœ¬æŒ‡å—åŸºäº 1Panel æœ€æ–°ç‰ˆæœ¬ç¼–å†™ï¼Œå¦‚é‡åˆ°ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œè¯·å‚è€ƒ 1Panel å®˜æ–¹æ–‡æ¡£ã€‚
